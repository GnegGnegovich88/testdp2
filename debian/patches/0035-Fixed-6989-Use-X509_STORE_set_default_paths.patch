From eaadeff1fc529f73d01a2a9699f840171c654e38 Mon Sep 17 00:00:00 2001
From: akallabeth <akallabeth@posteo.net>
Date: Mon, 3 May 2021 08:27:31 +0200
Subject: [PATCH] Fixed #6989: Use X509_STORE_set_default_paths

(cherry picked from commit b528ecde4f68d297b8464855a7ae0e02d36b78fc)
---
 libfreerdp/crypto/crypto.c | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/libfreerdp/crypto/crypto.c b/libfreerdp/crypto/crypto.c
index e61bd3bf1..82df956c2 100644
--- a/libfreerdp/crypto/crypto.c
+++ b/libfreerdp/crypto/crypto.c
@@ -846,9 +846,7 @@ BOOL x509_verify_certificate(CryptoCert cert, const char* certificate_store_path
 	                    NULL);
 #endif
 
-	lookup = X509_STORE_add_lookup(cert_ctx, X509_LOOKUP_file());
-
-	if (lookup == NULL)
+	if (X509_STORE_set_default_paths(cert_ctx) != 1)
 		goto end;
 
 	lookup = X509_STORE_add_lookup(cert_ctx, X509_LOOKUP_hash_dir());
-- 
2.30.2

